<!DOCTYPE html>
<html lang="en" class="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challenge's name</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                fontFamily: {
                    sans: ["Roboto", "sans-serif"],
                },
                extend: {
                    colors: {
                        gray: {
                            777: "hsl(220, 3%, 19%)",
                            888: "hsl(220, 4%, 16%)",
                            999: "hsl(220, 5%, 12%)",
                        },
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                    },
                    keyframes: {
                        jump: {
                            '0%, 100%': {
                                "transform": "translateY(-0.4)"
                            },
                            '50%': {
                                "transform": "translateY(0.4em)"
                            },
                        }
                    },
                    animation: {
                        jump: 'jump 2s ease-in-out infinite',
                    }
                }
            }
        };
    </script>
    <style>
        .material-symbols-rounded {
            font-variation-settings: 
                'FILL' 0,
                'wght' 400,
                'GRAD' 0, 
                'opsz' 24;
        }

        ::-webkit-scrollbar {
            height: .2em;
            width: .6em;
        }

        ::-webkit-scrollbar-track {
            background: hsl(0, 0%, 16%);
        }

        ::-webkit-scrollbar-thumb {
            border-radius: 0em;
            background: hsl(207, 31%, 94%);
            cursor: pointer;
        }
        
        .hidden-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hidden-scrollbar::-webkit-scrollbar {
            display: none;
        }

        @keyframes fade-in {
            from { opacity: 0; }
        }

            @keyframes fade-out {
            to { opacity: 0; }
        }

            @keyframes slide-from-right {
            from { transform: translateX(30px); }
        }

            @keyframes slide-to-left {
            to { transform: translateX(-30px); }
        }

            ::view-transition-old(user-card) {
            animation: 90ms cubic-bezier(0.4, 0, 1, 1) both fade-out,
                300ms cubic-bezier(0.4, 0, 0.2, 1) both slide-to-left;
        }

            ::view-transition-new(user-card) {
            animation: 210ms cubic-bezier(0, 0, 0.2, 1) 90ms both fade-in,
                300ms cubic-bezier(0.4, 0, 0.2, 1) both slide-from-right;
        }
    </style>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import * as HeroIcons from "https://cdn.skypack.dev/heroicons-react";

        const data = {
            users: [
                {
                    id: 1,
                    fullname: "Priya Kumar",
                    avatar: "https://cdn.midjourney.com/d2457f72-af23-4d2b-974f-e8fadf9fb33d/0_0.webp",
                    online: true,
                    following: [2, 3],
                    followers: [2],
                },
                {
                    id: 2,
                    fullname: "John Smith",
                    avatar: "https://cdn.midjourney.com/acdb2671-3b11-423a-8e11-a8622d006418/0_0.webp",
                    online: true,
                    following: [1],
                    followers: [1, 3],
                },
                {
                    id: 3,
                    fullname: "Miryam Davis",
                    avatar: "https://cdn.midjourney.com/15702769-9e28-48de-af36-59a4a563bccb/0_2.webp",
                    online: false,
                    following: [1, 2],
                    followers: [2, 3],
                },
            ],
            chats: [
                {
                    id: 1,
                    participants: [1, 2], 
                    messages: [
                        {
                            id:0,
                            authorId: 1,
                            sendAt: "2024-01-03T14:45:00",
                            content: "Hey, just wanted to confirm our shoot for this afternoon. Is everything still on track?"
                        },
                        {
                            id:1,
                            authorId: 2,
                            sendAt: "2024-01-03T14:46:00",
                            content: "Yes, everything's set for 3 PM. I was thinking about starting with the natural light by the windows. What do you think?"
                        },
                        {
                            id:2,
                            authorId: 1,
                            sendAt: "2024-01-03T14:47:00",
                            content: "Sounds perfect! I love shots with natural light. Do you have any particular themes in mind?"
                        },
                        {
                            id:3,
                            authorId: 2,
                            sendAt: "2024-01-03T14:48:00",
                            content: "I was thinking of a vintage, soft look for the first set. Then maybe something more bold and colorful for the second. I want to capture different facets of your versatility."
                        },
                        {
                            id:4,
                            authorId: 1,
                            sendAt: "2024-01-03T14:49:00",
                            content: "I'm excited about that. I brought a few outfits that should fit those themes perfectly. Also, is it okay if I bring a few props to experiment with?"
                        },
                        {
                            id:5,
                            authorId: 2,
                            sendAt: "2024-01-03T14:50:00",
                            content: "Absolutely, props can add a great touch. Just make sure they're easy to move around. We might switch locations quickly to catch the best light."
                        },
                        {
                            id:6,
                            authorId: 1,
                            sendAt: "2024-01-03T14:51:00",
                            content: "Got it. I'll keep it simple. How long do you think the shoot will last?"
                        },
                        {
                            id:7,
                            authorId: 2,
                            sendAt: "2024-01-03T14:52:00",
                            content: "If everything goes smoothly, we should wrap up in about two hours. I'll make sure there's plenty of water and snacks. Photoshoots can be unexpectedly draining."
                        },
                        {
                            id:8,
                            authorId: 1,
                            sendAt: "2024-01-03T14:53:00",
                            content: "Thanks for thinking of that. I appreciate it. Is there anything else I should know or bring?"
                        },
                        {
                            id:9,
                            authorId: 2,
                            sendAt: "2024-01-03T14:54:00",
                            content: "Just bring your energy and creativity! And maybe a backup outfit, just in case. I'm looking forward to working with you and creating something amazing."
                        },
                        {
                            id:10,
                            authorId: 1,
                            sendAt: "2024-01-03T14:55:00",
                            content: "Me too! See you soon!"
                        },
                    ]
                },
            ],
            chatParticipants: [
                {
                    userId: 1,
                    chatId: 1
                },
                {
                    userId: 2,
                    chatId: 1
                },
            ],
        }
        
        function App() {
            const VIEWS  = {USER_LIST: 0, USER_PROFILE: 1, CHAT: 2, VIEW_FILES: 3, CALL: 4};
            const [currentUser, setCurrentUser] = React.useState(data.users[1]);
            const [userToInterractWith, setUserToInterractWith] = React.useState(data.users[0]);
            const [currentView, setCurrentView] = React.useState(VIEWS.USER_LIST);
            const [currentChat, setCurrentChat] = React.useState(getChatByUserIds(currentUser, userToInterractWith));

            const handleClickOnViewProfile = (user) => {
                if(user === currentUser) {
                    setUserToInterractWith(currentUser)
                } else {
                    setUserToInterractWith(user);
                }

                setCurrentView(VIEWS.USER_PROFILE);
            }

            const handleGoBackToUserList = () => {
                setCurrentView(VIEWS.USER_LIST);
            }

            const handleDirectMessage = (user) => {
                if(user === currentUser) {
                    setCurrentChat(null);
                    setUserToInterractWith(null);
                } else {
                    const chat = getChatByUserIds(currentUser.id, user.id);
                    setUserToInterractWith(user);
                    setCurrentChat(chat)
                }

                setCurrentView(VIEWS.CHAT);
            }

            const handleSendMessage = (newMessage) => {
                const message = {
                    id: crypto.randomUUID(), 
                    content: newMessage,
                    authorId: currentUser.id, 
                    sendAt: formatDate(new Date())
                };
                
                setCurrentChat(previousChat => {
                    const updatedChat = {...previousChat};
                    updatedChat.messages = [...updatedChat.messages, message];
                    return updatedChat;
                });
            }

            return (
                <div className="bg-blue-900 text-white flex items-center justify-center w-full min-h-dvh">
                    <main 
                        className={`
                            grid gap-16 w-full max-w-7xl m-4 py-20 sm:m-8
                            ${currentView === VIEWS.USER_LIST && "lg:grid-cols-2 xl:grid-cols-3"}
                        `}
                    >
                        {currentView === VIEWS.USER_LIST && 
                            <React.Fragment>
                                {data.users.map(user => {
                                    return (
                                        <UserCard 
                                            key={user.id}
                                            user={user} 
                                            onViewProfile={() => handleClickOnViewProfile(user)}
                                            onDirectMessage={() => handleDirectMessage(user)}
                                            currentUser={currentUser}
                                        />
                                    )
                                })}
                            </React.Fragment>
                        }

                        {currentView === VIEWS.USER_PROFILE && 
                            <Profile user={userToInterractWith} onGoBack={handleGoBackToUserList}/>
                        }
                        
                        {currentView === VIEWS.CHAT && 
                            <Chat 
                                chat={currentChat} 
                                currentUser={currentUser} 
                                userToInterractWith={userToInterractWith} 
                                onGoBack={handleGoBackToUserList}
                                onSendMessage={handleSendMessage}
                                onUserListClick={handleClickOnViewProfile}
                            />
                        }
                    </main>
                </div>
            );
        }

        /**
         * 
         * @param {Object} user - The user to view
         * @param {integer} user.id - The unique identifier of the user.
         * @param {string} user.fullname - The fullname of the user.
         * @param {string} user.avatar - The user's avatar. 
         * */
        function UserCard({user, currentUser, onViewProfile, onDirectMessage}) {
            const [followState, setFollowState] = React.useState(isUserFollowed(currentUser.id, user.id));
            const userCardRef = React.useRef();
            const isCurrentUser = user === currentUser;

            return (
                <figure ref={userCardRef} className="place-self-center grid grid-rows-[auto_1fr] justify-center max-w-2xl [view-transition-name:user-card]">
                    <div className="relative w-full h-[12rem] aspect-video overflow-hidden">
                        <img src={user.avatar} alt="" className="w-full h-full object-cover"/>

                        <div className={`${user.online ? "bg-teal-500" : "bg-red-500"} absolute bottom-5 left-5 size-2 rounded-full`}>
                            <span className="sr-only">
                                {user.online ? "Online" : "Offline"}
                            </span>
                        </div>
                    </div>

                    <figcaption className="bg-blue-800 justify-self-center flex flex-col gap-2 px-4 py-8 w-[90%] shadow-lg sm:relative">
                        <button 
                            className="px-4 py-2 text-left font-medium hover:bg-blue-900 duration-500"
                            onClick={() => {
                                onViewProfile(user);
                            }}
                        >
                            View profile
                        </button>

                        <button 
                            className="px-4 py-2 text-left font-medium hover:bg-blue-900 duration-500"
                            onClick={() => {
                                onDirectMessage(user);
                            }}
                        >
                            Direct Messages
                        </button>

                        <button className="px-4 py-2 text-left font-medium hover:bg-blue-900 duration-500">
                            View files
                        </button>

                        <button className="px-4 py-2 text-left font-medium hover:bg-blue-900 duration-500">
                            Call
                        </button>

                        <button 
                            className={`
                                bg-yellow-500 text-blue-800 flex items-center px-8 py-4 text-xl font-semibold shadow-xl 
                                disabled:cursor-not-allowed disabled:bg-blue-700
                                hover:bg-yellow-400 duration-500 sm:absolute sm:-bottom-6 sm:-right-16
                            `}
                            disabled={isCurrentUser}
                            onClick={() => {setFollowState(!followState)}}
                        >
                            {(!isCurrentUser && !followState)  && 
                                <>
                                    <HeroIcons.Plus className="size-8"/>
                                    {`Follow ${user.fullname.split(" ")[0]}`}
                                </>
                            }
                            
                            {(!isCurrentUser && followState)  && 
                                <>
                                    {`Following`}
                                </>
                            }

                            {isCurrentUser && `(Me)`}
                        </button>
                    </figcaption>

                </figure>
            );
        }

        function Profile({user, onGoBack}) {
            const [activeTab, setActiveTab] = React.useState(true);

            return (
                <article className="place-self-center [view-transition-name:user-profile]">
                    <figure className="relative w-full min-h-[18rem] aspect-video overflow-hidden">
                        <img src={user.avatar} alt="" className="w-full h-full object-cover"/>

                        <figcaption className={`${user.online ? "bg-teal-500" : "bg-red-500"} absolute bottom-5 left-5 px-2 rounded-full`}>
                            <span className="">
                                {user.online ? "Online" : "Offline"}
                            </span>

                        </figcaption>

                        <button 
                            className="absolute top-4 left-4"
                            onClick={onGoBack}
                        >
                            <span className="material-symbols-rounded text-3xl">west</span>
                        </button>
                    </figure>

                    <div className="bg-blue-800 px-4 py-8 space-y-8 sm:px-8">
                        <h2 className="flex items-center gap-2">
                            <span className="text-2xl font-medium">
                                {user.fullname}
                            </span>

                            <span className={`bg-yellow-400 text-blue-900 text-sm font-medium px-4 py-2 rounded-full`}>
                                {user.followers.length} Followers
                            </span>
                        </h2>

                        <section className="grid grid-rows-[auto_1fr] gap-4">
                            <nav className="grid grid-cols-2">
                                <button 
                                    className={`${activeTab ? "bg-blue-700 border-transparent" : "border-blue-700"} p-4 text-center border transition-[background-color] duration-500`} 
                                    onClick={() => setActiveTab(true)}
                                >
                                    Followers
                                </button>

                                <button 
                                    className={`${!activeTab ? "bg-blue-700 border-transparent" : "border-blue-700"} p-4 text-center border transition-[background-color] duration-500`} 
                                    onClick={() => setActiveTab(false)}
                                >
                                    Following
                                </button>
                            </nav>

                            <ul>
                                {activeTab && user.followers.map(userId => {
                                    const user = getUserById(userId);

                                    return (
                                        <li className="grid grid-cols-[auto_1fr_auto] items-center gap-4 max-w-sm p-4 border border-blue-700/50 hover:bg-blue-700 duration-500">
                                            <div className="size-12 rounded-full overflow-hidden">
                                                <img src={user.avatar} alt="" className="size-full object-cover"/>
                                            </div>

                                            <div>
                                                <h4 className="font-medium">
                                                    {user.fullname}
                                                </h4>

                                                <p>{user.followers} Followers</p>
                                            </div>

                                            <button className="px-4 py-2 border border-white hover:bg-blue-900 duration-500">
                                                Follow
                                            </button>
                                        </li>
                                    );
                                })}
                                
                                {!activeTab && user.following.map(userId => {
                                    const user = getUserById(userId);

                                    return (
                                        <li className="grid grid-cols-[auto_1fr_auto] items-center gap-4 max-w-sm p-4 border border-blue-700/50 hover:bg-blue-700 duration-500">
                                            <div className="size-12 rounded-full overflow-hidden">
                                                <img src={user.avatar} alt="" className="size-full object-cover"/>
                                            </div>

                                            <div>
                                                <h4 className="font-medium">
                                                    {user.fullname}
                                                </h4>

                                                <p>{user.followers} Followers</p>
                                            </div>

                                            <button className="px-4 py-2 border border-white hover:bg-blue-900 duration-500">
                                                Follow
                                            </button>
                                        </li>
                                    );
                                })}
                            </ul>
                        </section>
                    </div>
                </article>
            );
        }

        function Chat({chat, currentUser, userToInterractWith, onGoBack, onSendMessage, onUserListClick}) {
            const [message, setMessage] = React.useState("");
            const messageRef = React.useRef();

            const handleMessageSubmit = (event) => {
                event.preventDefault();
                onSendMessage(message);
                setMessage("");
            }
            console.log("currentUser === userToInterractWith: ", currentUser === userToInterractWith);

            return (
                <section className="bg-blue-800 grid gap-12 w-full max-w-7xl">
                    <header className="bg-blue-700 flex items-center justify-between gap-4 px-4 py-2 sm:px-8">
                        <button 
                            className="h-full w-auto aspect-square px-4 py-2 hover:bg-blue-800 duration-500"
                            onClick={onGoBack}
                        >
                            <span className="material-symbols-rounded text-3xl">west</span>
                        </button>
    
                        <figure className="flex items-center gap-2">
                            <div className="size-16 rounded-full overflow-hidden">
                                <img 
                                    src={!userToInterractWith ? currentUser.avatar : userToInterractWith.avatar} alt="" 
                                    className="size-full object-cover"
                                />
                            </div>
    
                            <figcaption className="-order-1">
                                <h2 className="font-medium">
                                    {!userToInterractWith ? currentUser.fullname : userToInterractWith.fullname}
                                </h2>
                            </figcaption>
                        </figure>
                    </header>

                    <main className="grid gap-4 p-4 pb-8 sm:px-8">
                        {chat && 
                            <>
                            {
                                chat.messages.map(message => {
                                    let user = getUserById(message.authorId);
                                    return (
                                        <article 
                                            key={message.id} 
                                            className={`
                                                grid ${message.authorId === currentUser.id ? "grid-cols-[auto_1fr]" : "grid-cols-[1fr_auto]"} gap-4
                                            `}
                                        >
                                            <div className={`size-12 rounded-full overflow-hidden ${message.authorId !== currentUser.id && "order-1"}`}>
                                                <img src={user.avatar} alt="" className="size-full object-cover"/>
                                            </div>

                                            <div className="grid gap-2">
                                                <p 
                                                    className={`
                                                        py-2
                                                        ${message.authorId === currentUser.id ? "bg-blue-900 w-fit px-8 0" : "justify-self-end px-0"} 
                                                        ${message.authorId === currentUser.id && "relative before:absolute before:-left-1.5 before:top-4 before:size-3 before:bg-blue-900 before:rotate-45"}
                                                    `}
                                                >
                                                    {message.content}
                                                </p>
        
                                                <p className="text-white/60 text-sm text-left ml-auto">Sent {new Date(message.sendAt).toLocaleDateString()}</p>
                                            </div>
                                        </article>
                                    );
                                })
                            }

                                <form className="flex items-enter gap-2 w-full" onSubmit={handleMessageSubmit}>
                                    <input 
                                        type="text" 
                                        placeholder="Message" 
                                        className="bg-blue-700 w-full px-4 py-2 rounded focus:outline-blue-900"
                                        value={message}
                                        onChange={(e) => setMessage(e.target.value)}
                                    />

                                    <button type="submit">
                                        <span className="sr-only">Send message</span>
                                        <HeroIcons.PaperAirplane className="rotate-90"/>
                                    </button>
                                </form>
                            </>
                        }

                        {(userToInterractWith && !chat) && 
                            <>
                                {!chat && <p>Start new discussion with {userToInterractWith.fullname.split(" ")[0]}</p>}

                                <form className="flex items-enter gap-2 w-full" onSubmit={handleMessageSubmit}>
                                    <input 
                                        type="text" 
                                        placeholder="Message" 
                                        className="bg-blue-700 w-full px-4 py-2 rounded focus:outline-blue-900"
                                        value={message}
                                        onChange={(e) => setMessage(e.target.value)}
                                    />

                                    <button type="submit">
                                        <span className="sr-only">Send message</span>
                                        <HeroIcons.PaperAirplane className="rotate-90"/>
                                    </button>
                                </form>
                            </>
                        }

                        {!userToInterractWith &&
                            <div className="relative size-fit">
                                {getChatsForUser(currentUser.id).map(user => {
                                    return (
                                        <div 
                                            key={user.id} 
                                            className="group size-16 flex rounded-full overflow-hidden cursor-pointer"
                                            onClick={() => onUserListClick(user)}
                                        >
                                            <img src={user.avatar} alt="" className="size-full object-cover"/>

                                            <div 
                                                className={`
                                                    bg-gray-800 text-white flex-none absolute bottom-[105%] left-1/2 -translate-x-1/2 
                                                    w-24 p-2 rounded text-sm font-medium opacity-0 group-hover:opacity-100 duration-500
                                                `}
                                            >
                                                {user.fullname}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        }
                    </main>
                </section>
            );
        }

        function getUserById(userId) {
            const user = data.users.find(user => user.id === userId);

            return user || null;
        }

        // Retrieve a chat based on two users
        function getChatByUserIds(userId1, userId2) {
            // Find chat IDs where both users are participants
            const sharedChats = data.chats.filter(chat =>
                chat.participants.includes(userId1) && chat.participants.includes(userId2)
            );

            return sharedChats.length > 0 ? sharedChats[0] : null;
        }

        function getChatsForUser(userId) {
            // Find all chat IDs for the given user
            const userChats = data.chatParticipants
                .filter(participant => participant.userId === userId)
                .map(participant => participant.chatId);

            // Find all unique user IDs from these chats (excluding the given user)
            const chatUserIds = new Set();
            data.chatParticipants.forEach(participant => {
                if (userChats.includes(participant.chatId) && participant.userId !== userId) {
                    chatUserIds.add(participant.userId);
                }
            });

            // Retrieve user objects for these IDs
            return data.users.filter(user => chatUserIds.has(user.id));
        }

        function getFollowedUsers(userId) {
            const user = data.users.find(u => u.id === userId);
            if (!user || !user.following) return [];
            
            return data.users.filter(u => user.following.includes(u.id));
        }

        function getFollowers(userId) {
            const user = data.users.find(u => u.id === userId);
            if (!user || !user.followers) return [];
            
            return data.users.filter(u => user.followers.includes(u.id));
        }

        function isUserFollowed(currentUserId, targetUserId) {
        const currentUser = data.users.find(user => user.id === currentUserId);

         if (currentUser && currentUser.following) {
            return currentUser.following.includes(targetUserId);
        }

        return false;
}

        function formatDate(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');

            return `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`;
        }
    
        const container = document.getElementById("root");
        const root = ReactDOM.createRoot(container);
        root.render(<App />);  
</script>
</body>

</html>